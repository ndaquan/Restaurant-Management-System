<!-- views/editDish.ejs -->
<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Ch·ªânh s·ª≠a m√≥n ƒÉn</title>
  <link rel="stylesheet" href="/css/editDish.css">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
</head>
<body>
<div>
  <header class="menu-header">
    <button class="btn-return fas fa-chevron-left fa-lg" onclick="window.location.href='/admin/editMenu'">
    </button>
    <h1>Ch·ªânh s·ª≠a m√≥n ƒÉn</h1>
  </header>
  <div class="form-wrapper">
    <div class="form-container">
      <div class="image-container">
        <img src="<%= dish.imageUrl %>" alt="·∫¢nh m√≥n ƒÉn hi·ªán t·∫°i">
      </div>

      <form id="editDishForm" onsubmit="handleEditFormSubmit(event)">
        <input type="hidden" id="dishId" name="dishId" value="<%= dish._id %>">

        <div class="form-group">
          <label for="foodName">T√™n m√≥n ƒÉn</label>
          <input type="text" id="foodName" name="foodName" value="<%= dish.foodName %>" required>
        </div>

        <div class="form-group">
          <label for="description">M√¥ t·∫£</label>
          <textarea id="description" name="description" rows="3" required><%= dish.description %></textarea>
        </div>

        <div class="form-group">
          <label for="price">Gi√°</label>
          <input type="number" id="price" name="price" value="<%= dish.price %>" required>
        </div>

        <div class="form-group">
          <label for="image">Ch·ªçn ·∫£nh m·ªõi (n·∫øu c√≥)</label>
          <input type="file" id="image" name="image" accept="image/*">
        </div>

        <button type="submit" class="submit-btn">C·∫≠p nh·∫≠t m√≥n ƒÉn</button>
      </form>
    </div>
  </div>
</div>

<script>
  async function handleEditFormSubmit(event) {
    event.preventDefault(); // NgƒÉn ch·∫∑n form g·ª≠i ƒëi theo c√°ch th√¥ng th∆∞·ªùng

    const form = document.getElementById("editDishForm");
    const formData = new FormData(form);
    const dishId = document.getElementById("dishId").value;

    try {
      // G·ª≠i FormData (bao g·ªìm file n·∫øu c√≥) tr·ª±c ti·∫øp
      const response = await fetch(`/admin/editMenu/${dishId}`, {
        method: "PUT",
        body: formData
      });

      const data = await response.json();

      if (data.success) {
        Swal.fire({
          title: "üéâ C·∫≠p nh·∫≠t th√†nh c√¥ng!",
          text: "M√≥n ƒÉn ƒë√£ ƒë∆∞·ª£c ch·ªânh s·ª≠a.",
          icon: "success",
          confirmButtonText: "OK",
          background: "#ffffff",
          color: "#333",
          padding: "20px",
          showClass: {
            popup: "animate__animated animate__zoomIn"
          },
          hideClass: {
            popup: "animate__animated animate__fadeOutDown"
          }
        }).then(() => {
          window.location.href = "/admin/editMenu"; // Chuy·ªÉn v·ªÅ danh s√°ch m√≥n ƒÉn sau khi admin b·∫•m OK
        });
      } else {
        Swal.fire({
          title: "L·ªói!",
          text: data.message,
          icon: "error",
          confirmButtonText: "Th·ª≠ l·∫°i",
        });
      }
    } catch (error) {
      Swal.fire({
        title: "L·ªói!",
        text: "C√≥ l·ªói x·∫£y ra khi c·∫≠p nh·∫≠t m√≥n ƒÉn.",
        icon: "error",
        confirmButtonText: "Th·ª≠ l·∫°i",
      });
    }
  }
</script>
</body>
</html>
