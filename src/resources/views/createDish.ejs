<!-- views/createDish.ejs -->
<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>T·∫°o m√≥n ƒÉn m·ªõi</title>
  <link rel="stylesheet" href="/css/createDish.css">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
</head>
<div>
  <header class="menu-header">
    <button class="btn-return fas fa-chevron-left fa-lg" onclick="window.location.href='/admin/editMenu'">
    </button>
    <h1>T·∫°o m√≥n ƒÉn m·ªõi</h1>
  </header>
<div class="form-wrapper">
  <div class="form-container">
    <form id="createDishForm" onsubmit="handleFormSubmit(event)">
      <div class="form-group">
        <label for="foodName">T√™n m√≥n ƒÉn</label>
        <input type="text" id="foodName" name="foodName" placeholder="Nh·∫≠p t√™n m√≥n ƒÉn" required>
      </div>
    
      <div class="form-group">
        <label for="description">M√¥ t·∫£</label>
        <textarea id="description" name="description" rows="3" placeholder="M√¥ t·∫£ chi ti·∫øt m√≥n ƒÉn" required></textarea>
      </div>
    
      <div class="form-group">
        <label for="price">Gi√°</label>
        <input type="number" id="price" name="price" placeholder="Nh·∫≠p gi√°" required>
      </div>
      
      <div class="form-group">
        <label for="category">Danh m·ª•c m√≥n ƒÉn</label>
        <select id="category" name="category" required>
          <% categories.forEach(cat => { %>
            <option value="<%= cat._id %>"><%= cat.categoryName %></option>
          <% }) %>
        </select>
      </div>
      
      <div class="form-group">
        <label for="image">·∫¢nh m√≥n ƒÉn</label>
        <input type="file" id="image" name="image" placeholder="image/*" required>
      </div>
    
      <button type="submit" class="submit-btn">T·∫°o m√≥n ƒÉn</button>
    </form>
  </div>
</div>
<script>
  async function handleFormSubmit(event) {
    event.preventDefault(); // NgƒÉn form g·ª≠i theo c√°ch truy·ªÅn th·ªëng
    const form = document.getElementById("createDishForm");
    const formData = new FormData(form);

    try {
      // G·ª≠i FormData (bao g·ªìm file) tr·ª±c ti·∫øp
      const response = await fetch("/admin/editMenu", {
        method: "POST",
        body: formData
      });

      const data = await response.json();

      if (data.success) {
        Swal.fire({
          title: "Ho√†n t·∫•t!",
          text: "üéâ T·∫°o m√≥n ƒÉn th√†nh c√¥ng",
          icon: "success",
          confirmButtonText: "OK",
        }).then(() => {
          window.location.href = "/admin/editMenu"; // Chuy·ªÉn v·ªÅ danh s√°ch m√≥n ƒÉn
        });
      } else {
        Swal.fire({
          title: "L·ªói!",
          text: data.message,
          icon: "error",
          confirmButtonText: "Th·ª≠ l·∫°i",
        });
      }
    } catch (error) {
      Swal.fire({
        title: "L·ªói!",
        text: "C√≥ l·ªói x·∫£y ra khi g·ª≠i d·ªØ li·ªáu.",
        icon: "error",
        confirmButtonText: "Th·ª≠ l·∫°i",
      });
    }
  }
</script>
</body>
</html>
